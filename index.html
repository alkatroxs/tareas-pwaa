<!doctype html><html lang='es'><head><meta charset='utf-8'/><meta name='viewport' content='width=device-width, initial-scale=1, viewport-fit=cover'/><title>Tareas Diarias</title><meta name='apple-mobile-web-app-capable' content='yes'/><meta name='apple-mobile-web-app-status-bar-style' content='black-translucent'/><meta name='apple-mobile-web-app-title' content='Tareas'/><link rel='manifest' href='./manifest.webmanifest'/><link rel='apple-touch-icon' href='./icons/icon-192.png'/><meta name='theme-color' content='#10b981'/><style>:root{--bg:#f6f7fb;--card:#fff;--ink:#101214;--muted:#6b7280;--brand:#10b981;--line:#e5e7eb;--bad:#ef4444;--ok:#10b981}*{box-sizing:border-box}body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica Neue,Arial,Apple Color Emoji,Segoe UI Emoji;background:var(--bg);color:var(--ink)}.wrap{max-width:720px;margin:0 auto;padding:24px}header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:16px}h1{font-size:22px;margin:0}.muted{color:var(--muted);font-size:12px}.card{background:var(--card);border:1px solid var(--line);border-radius:16px;box-shadow:0 1px 2px rgba(0,0,0,.04)}.inputbar{display:flex;gap:8px;padding:12px}input[type=text]{flex:1;padding:10px 12px;border:1px solid var(--line);border-radius:12px;font-size:14px;outline:none}input[type=text]:focus{border-color:#cbd5e1;box-shadow:0 0 0 3px rgba(16,185,129,.15)}.btn{appearance:none;border:none;border-radius:12px;padding:10px 14px;font-weight:600;background:#111827;color:#fff;box-shadow:0 1px 2px rgba(0,0,0,.15)}.btn:active{transform:scale(.98)}.btn-ghost{background:#fff;color:#111827;border:1px solid var(--line)}.list{display:grid;gap:10px;padding:12px}.item{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px;border:1px solid var(--line);border-radius:16px;background:#fff}.left{display:flex;align-items:center;gap:12px;min-width:0}.tick{width:36px;height:36px;display:grid;place-items:center;border-radius:999px;border:1px solid var(--line);background:#fff;font-size:18px}.tick.done{background:var(--brand);border-color:#059669;color:#fff}.name{font-size:15px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.name.done{text-decoration:line-through;opacity:.6}.row-actions{display:flex;gap:8px}.link{font-size:12px;color:#111827;text-decoration:underline;background:none;border:none;padding:0}footer{text-align:center;margin:18px 0 40px}.progress{height:10px;background:#eef2f7;border-radius:999px;overflow:hidden;border:1px solid var(--line)}.bar{height:100%;background:var(--brand);width:0%;transition:width .2s ease}.banner{margin:12px 0 0;font-size:12px;padding:8px 12px;border-radius:12px;border:1px dashed var(--line);color:var(--muted)}.history-card{margin-top:16px}.history-head{display:flex;align-items:center;justify-content:space-between;padding:12px;border-bottom:1px solid var(--line)}.legend{display:flex;gap:10px;font-size:12px;color:var(--muted);align-items:center}.dot{width:10px;height:10px;border-radius:999px;display:inline-block;border:1px solid var(--line)}.dot.ok{background:var(--ok);border-color:#059669}.dot.bad{background:#fef2f2;border-color:#fecaca}.dot.none{background:#e5e7eb}.history{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;padding:12px}.day{aspect-ratio:1/1;border-radius:12px;border:1px solid var(--line);display:flex;align-items:center;justify-content:center;font-size:12px;background:#fff}.day.ok{background:#ecfdf5;border-color:#a7f3d0}.day.bad{background:#fef2f2;border-color:#fecaca}.day.none{background:#f8fafc}.day span{opacity:.8}</style></head><body><div class='wrap'><header><div><h1>Tareas Diarias</h1><div class='muted' id='meta'></div></div><button class='btn btn-ghost' id='resetBtn' title='Reiniciar estado de hoy'>Reiniciar hoy</button></header><div id='installBanner' class='banner' style='display:none;'>Para instalar: en Safari, Compartir → <b>Agregar a pantalla de inicio</b>.</div><div class='card'><div class='inputbar'><input id='newTask' type='text' placeholder='Agregar tarea diaria (ej: 10 min de lectura)'/><button id='addBtn' class='btn'>Añadir</button></div><div style='padding:0 12px 12px;'><div class='progress'><div class='bar' id='bar'></div></div></div><div class='list' id='list'></div></div><div class='card history-card'><div class='history-head'><div class='muted'>Historial (últimos 30 días)</div><div class='legend'><span class='dot ok'></span> Cumplido <span class='dot bad'></span> No cumplido <span class='dot none'></span> Sin tareas</div></div><div class='history' id='history'></div></div><footer class='muted'>Funciona offline. Las tareas se guardan en el dispositivo y las tildes se reinician cada día (hora local).</footer></div><script>if('serviceWorker'in navigator){window.addEventListener('load',()=>{navigator.serviceWorker.register('./sw.js').catch(console.error)})}const isStandalone=window.matchMedia('(display-mode: standalone)').matches||window.navigator.standalone;if(!isStandalone){const e=document.getElementById('installBanner');e&&(e.style.display='block')}const todayKey = () => {
  const d = new Date();
  const yyyy = d.getFullYear();
  const mm = String(d.getMonth() + 1).padStart(2, '0');
  const dd = String(d.getDate()).padStart(2, '0');
  return `${yyyy}-${mm}-${dd}`; // YYYY-MM-DD en hora local
};LS={tasks:'daily_tasks_v1',doneMap:'daily_done_map_v1',lastDate:'daily_last_date_v1',statusMap:'daily_status_map_v1',tasksTotalMap:'daily_tasks_total_map_v1'},read=(e,t)=>{try{const a=localStorage.getItem(e);return a?JSON.parse(a):t}catch{return t}},write=(e,t)=>localStorage.setItem(e,JSON.stringify(t)),uid=()=>Math.random().toString(36).slice(2,9);let tasks=read(LS.tasks,null);tasks&&Array.isArray(tasks)&&0!==tasks.length||(tasks=[{id:uid(),name:'Hacer la cama'},{id:uid(),name:'Tomar 2 vasos de agua'},{id:uid(),name:'Revisar pendientes del día'}],write(LS.tasks,tasks));const doneMap=read(LS.doneMap,{}),statusMap=read(LS.statusMap,{}),tasksTotalMap=read(LS.tasksTotalMap,{});let dateKey=todayKey();dateKey in tasksTotalMap||(tasksTotalMap[dateKey]=tasks.length,write(LS.tasksTotalMap,tasksTotalMap));let done=new Set(doneMap[dateKey]||[]);write(LS.lastDate,dateKey);const listEl=document.getElementById('list'),newTaskEl=document.getElementById('newTask'),addBtn=document.getElementById('addBtn'),resetBtn=document.getElementById('resetBtn'),metaEl=document.getElementById('meta'),barEl=document.getElementById('bar'),historyEl=document.getElementById('history');function computeAndStoreStatus(e){const t=void 0!==tasksTotalMap[e]?tasksTotalMap[e]:e===dateKey?tasks.length:0,a=new Set(doneMap[e]||[]),n=a.size;let o='none';t>0&&(o=n>=t?'ok':'bad'),statusMap[e]={status:o,total:t,done:n},write(LS.statusMap,statusMap)}function ensureSnapshotFor(e){e in tasksTotalMap||(tasksTotalMap[e]=e===dateKey?tasks.length:0,write(LS.tasksTotalMap,tasksTotalMap))}function render(){const e=tasks.length,t=tasks.reduce((e,t)=>e+(done.has(t.id)?1:0),0),a=e?Math.round(t/e*100):0;metaEl.textContent=`${dateKey} • Progreso: ${t}/${e} (${a}%)`,barEl.style.width=a+'%',listEl.innerHTML='',0===e?((o=document.createElement('div')).className='item',o.innerHTML='<div class="muted">No hay tareas aún. ¡Agregá la primera arriba!</div>',listEl.appendChild(o)):tasks.forEach(e=>{const t=document.createElement('div');t.className='item';const a=document.createElement('div');a.className='left';const n=document.createElement('button');n.className='tick'+(done.has(e.id)?' done':''),n.textContent=done.has(e.id)?'✔':'',n.title=done.has(e.id)?'Desmarcar':'Marcar como hecho',n.onclick=()=>{toggleDone(e.id)};const o=document.createElement('span');o.className='name'+(done.has(e.id)?' done':''),o.textContent=e.name,o.ondblclick=()=>startEdit(t,e),a.appendChild(n),a.appendChild(o);const d=document.createElement('div');d.className='row-actions';const s=document.createElement('button');s.className='link',s.textContent='Editar',s.onclick=()=>startEdit(t,e);const l=document.createElement('button');l.className='link',l.style.color='#ef4444',l.textContent='Borrar',l.onclick=()=>deleteTask(e.id),d.appendChild(s),d.appendChild(l),t.appendChild(a),t.appendChild(d),listEl.appendChild(t)}),computeAndStoreStatus(dateKey),renderHistory();var o}function renderHistory(){historyEl.innerHTML='';const e=new Date(dateKey);for(let t=29;t>=0;t--){const a=new Date(e);a.setDate(a.getDate()-t);const n=a.toISOString().slice(0,10);ensureSnapshotFor(n),computeAndStoreStatus(n);const o=statusMap[n],d=document.createElement('div');d.className='day '+(o&&o.status||'none');const s=String(a.getDate()).padStart(2,'0');d.innerHTML=`<span>${s}</span>`,d.title=`${n} • ${labelFor(o&&o.status)} — Hechas: ${(o&&o.done)||0}/${(o&&o.total)||0}`,historyEl.appendChild(d)}}function labelFor(e){return'ok'===e?'Cumplido':'bad'===e?'No cumplido':'Sin tareas'}function startEdit(e,t){const a=document.createElement('input');function n(){renameTask(t.id,a.value)}a.type='text',a.value=t.name,a.className='name',a.style.width='100%',a.onkeydown=e=>{'Enter'===e.key&&n()},a.onblur=n;const o=e.querySelector('.left');o.replaceChild(a,o.querySelector('.name')),a.focus(),a.setSelectionRange(a.value.length,a.value.length)}function toggleDone(e){done.has(e)?done.delete(e):done.add(e),persistDone(),render()}function addTask(){const e=(newTaskEl.value||'').trim();e&&(tasks.push({id:uid(),name:e}),newTaskEl.value='',write(LS.tasks,tasks),dateKey in tasksTotalMap||(tasksTotalMap[dateKey]=tasks.length,write(LS.tasksTotalMap,tasksTotalMap)),render())}function deleteTask(e){tasks=tasks.filter(t=>t.id!==e),write(LS.tasks,tasks),done.has(e)&&done.delete(e),persistDone(),render()}function renameTask(e,t){t=(t||'').trim(),t&&(tasks=tasks.map(a=>a.id===e?{...a,name:t}:a),write(LS.tasks,tasks),render())}function resetToday(){done=new Set,persistDone(),render()}function persistDone(){doneMap[dateKey]=Array.from(done),write(LS.doneMap,doneMap),write(LS.lastDate,dateKey)}setInterval(()=>{const e=todayKey();e!==dateKey&&(dateKey=e,done=new Set,doneMap[dateKey]=[],write(LS.doneMap,doneMap),write(LS.lastDate,dateKey),tasksTotalMap[dateKey]=tasks.length,write(LS.tasksTotalMap,tasksTotalMap),render())},3e4),addBtn.onclick=addTask,newTaskEl.onkeydown=e=>{'Enter'===e.key&&addTask()},resetBtn.onclick=resetToday,render();</script></body></html>